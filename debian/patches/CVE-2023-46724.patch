From: Markus Koschany <apo@debian.org>
Date: Mon, 19 Feb 2024 12:09:15 +0100
Subject: CVE-2023-46724

Bug-Debian: https://bugs.debian.org/1055252
Origin: http://www.squid-cache.org/Versions/v5/SQUID-2023_4.patch
---
 src/anyp/Uri.cc | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/src/anyp/Uri.cc b/src/anyp/Uri.cc
index 94b3bb4..7ccad93 100644
--- a/src/anyp/Uri.cc
+++ b/src/anyp/Uri.cc
@@ -173,6 +173,10 @@ urlInitialize(void)
     assert(0 == matchDomainName("*.foo.com", ".foo.com", mdnHonorWildcards));
     assert(0 != matchDomainName("*.foo.com", "foo.com", mdnHonorWildcards));
 
+    assert(0 != matchDomainName("foo.com", ""));
+    assert(0 != matchDomainName("foo.com", "", mdnHonorWildcards));
+    assert(0 != matchDomainName("foo.com", "", mdnRejectSubsubDomains));
+
     /* more cases? */
 }
 
@@ -756,6 +760,8 @@ matchDomainName(const char *h, const char *d, MatchDomainNameFlags flags)
         return -1;
 
     dl = strlen(d);
+    if (dl == 0)
+        return 1;
 
     /*
      * Start at the ends of the two strings and work towards the
